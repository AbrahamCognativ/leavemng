<div class="leave-request-details">
  <dx-load-indicator *ngIf="isLoading"></dx-load-indicator>

  <div class="content-block" *ngIf="!isLoading && leaveRequest">
    <div class="dx-card leave-request-details">
      <div class="header">
        <h2>Leave Request Details</h2>
        <div class="status-badge" [ngClass]="getStatusClass(leaveRequest.status)">
          {{ leaveRequest.status | titlecase }} <span *ngIf="leaveRequest.status === 'approved' && leaveRequest.decision_at">on {{ leaveRequest.decision_at | date:'medium' }}</span>
        </div>

      </div>

      <dx-scroll-view>
        <div class="details-container">
          <div class="section">
            <h3>Employee Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Employee Name</label>
                <span>{{ leaveRequest.user_name }}</span>
              </div>
            </div>
          </div>

          <div class="section">
            <h3>Leave Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Leave Type</label>
                <span>{{ leaveRequestLeaveType.description }}</span>
              </div>
              <div class="info-item">
                <label>Start Date</label>
                <span>{{ leaveRequest.start_date | date:'mediumDate' }}</span>
              </div>
              <div class="info-item">
                <label>End Date</label>
                <span>{{ leaveRequest.end_date | date:'mediumDate' }}</span>
              </div>
              <div class="info-item" v-if="leaveRequest.duration">
                <label>Duration</label>
                <span>{{ leaveRequest.duration }} {{ leaveRequest.duration > 1 ? 'days' : 'day' }}</span>
              </div>
            </div>
          </div>

          <div class="section">
            <h3>Request Details</h3>
            <div class="info-grid">
              <div class="info-item full-width">
                <label>Reason</label>
                <span>{{ leaveRequest.comments ? leaveRequest.comments : 'No reason provided' }}</span>
              </div>
              <div class="info-item">
                <label>Requested On</label>
                <span>{{ leaveRequest.applied_at | date:'medium' }}</span>
              </div>
              <div class="info-item" *ngIf="leaveRequest.updated_at">
                <label>Last Updated</label>
                <span>{{ leaveRequest.updated_at | date:'medium' }}</span>
              </div>
            </div>
          </div>

          <div class="section" >
            <h3>Supporting Documents</h3>
            <div class="documents-list" *ngIf="documents.length > 0">
              <div class="document-item" *ngFor="let doc of documents">
                <div class="document-info">
                  <i class="dx-icon-file"></i>
                  <span>{{ doc.file_name }}</span>
                </div>
                <dx-button
                  icon="download"
                  stylingMode="text"
                  (onClick)="downloadDocument(doc.id)">
                </dx-button>
              </div>
            </div>
            <div class="section" *ngIf="documents.length === 0">
              <p>The employee did not upload any supporting documents for this leave request.</p>
            </div>
          </div>

          <div class="decided-by" *ngIf="leaveRequest.status === 'approved' && leaveRequest.decided_by">
            Approved by: <span style="font-style: italic; font-weight: bold;">{{ leaveRequest.decided_by }}</span>
          </div>
        </div>
      </dx-scroll-view>

      <div class="actions" *ngIf="leaveRequest.status === 'pending' && !isLeaveRequestOwner">
        <dx-button
          [text]="isApproving ? 'Approving...' : 'Approve'"
          type="success"
          stylingMode="contained"
          [disabled]="isApproving || isRejecting"
          (onClick)="approveRequest()">
        </dx-button>
        <dx-button
          [text]="isRejecting ? 'Rejecting...' : 'Reject'"
          type="danger"
          stylingMode="contained"
          [disabled]="isApproving || isRejecting"
          (onClick)="rejectRequest()">
        </dx-button>
      </div>
    </div>
  </div>
</div>
