<div class="org-units-container">
  <dx-load-indicator *ngIf="isLoading"></dx-load-indicator>

  <div class="section">
    <div class="section-header">
      <h2>Organization Units</h2>
      <dx-button
        text="Add Organization Unit"
        type="default"
        stylingMode="contained"
        (onClick)="onAdd()">
      </dx-button>
    </div>

    <dx-data-grid
      [dataSource]="orgUnits"
      [showBorders]="true"
      [columnAutoWidth]="true"
      [rowAlternationEnabled]="true">
      <dxi-column dataField="name" caption="Name"></dxi-column>
      <dxi-column dataField="description" caption="Description"></dxi-column>
      <dxi-column
        dataField="parent_id"
        caption="Parent Unit"
        [calculateCellValue]="getParentName">
      </dxi-column>
      <dxi-column type="buttons">
        <dxi-button
          name="edit"
          icon="edit"
          (onClick)="onEdit($event)">
        </dxi-button>
        <dxi-button
          name="delete"
          icon="trash"
          (onClick)="delete($event)">
        </dxi-button>
      </dxi-column>
    </dx-data-grid>
  </div>

  <!-- Organization Unit Form Popup -->
  <dx-popup
    [visible]="isPopupVisible"
    [showTitle]="true"
    [title]="selectedUnit ? 'Edit Organization Unit' : 'Add Organization Unit'"
    [width]="400"
    [height]="400"
    [dragEnabled]="false"
    [closeOnOutsideClick]="true"
    (onHiding)="isPopupVisible = false">
    <dxo-toolbar
      [visible]="true">
      <dxi-item
        widget="dxButton"
        location="after"
        [options]="{
          text: 'Save',
          type: 'default',
          stylingMode: 'contained',
          onClick: save
        }">
      </dxi-item>
    </dxo-toolbar>
    <dx-form
      [formData]="formData"
      labelLocation="top"
      [showColonAfterLabel]="true">
      <dxi-item dataField="name" editorType="dxTextBox"></dxi-item>
      <dxi-item dataField="description" editorType="dxTextBox"></dxi-item>
      <dxi-item
        dataField="parent_id"
        editorType="dxSelectBox"
        [editorOptions]="{
          dataSource: orgUnits,
          displayExpr: 'name',
          valueExpr: 'id',
          placeholder: 'Select parent unit'
        }">
      </dxi-item>
    </dx-form>
  </dx-popup>
</div> 